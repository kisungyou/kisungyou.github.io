{
  "hash": "7668b2372672adeb95b316366d91b36a",
  "result": {
    "markdown": "---\npagetitle: \"KY-Blog\"\ntitle: \"What is the gradient of squared distance on a Riemannian manifold?\"\ndate: 2025-05-24\ncategories:\n  - What is?\nformat: \n  html:\n    df-print: paged\n    toc: true\nengine: knitr\ncitation: true\ncomments: false\nbibliography: biball.bib\nbiblio-style: plain\ngoogle-scholar: false\nnumber-sections: true\n#image: images/figure_002_ACG.png\nauthor:\n  - name: Kisung You\n---\n\n\n::: {.hidden}\n$$\n\\newcommand{\\bbR}{\\mathbb{R}}\n\\newcommand{\\calD}{\\mathcal{D}}\n\\newcommand{\\calM}{\\mathcal{M}}\n\\newcommand{\\calP}{\\mathcal{P}}\n\\DeclareMathOperator{\\argmin}{argmin}\n$$\n:::\n\nOne of the most fundamental objects in geometric statistics and computation thereof is \nthe squared Riemannian distance function $d^2(p,q)$ defined on a [Riemannian manifold](https://en.wikipedia.org/wiki/Riemannian_manifold) $(\\calM, g)$. This function is central to optimization, variational formulations, and the definition of Fr√©chet means on manifolds. A key identity often invoked but not always derived is:\n$$\n\\nabla_x d^2(x,y) = -2\\log_x y,\n$$\nwhere $\\log_x y$ is the logarithmic map, which pulls a point $y$ to the tangent space at $x$[^1]. This is the manifold generalization of the Euclidean identity $\\nabla_x \\|x-y\\|^2 = -2(x-y)$, where $\\|\\cdot\\|$ is the Euclidean norm.\n\n\nI first encountered this identity when I was writing my own code during my doctoral studies. I encountered the proof on [Stack Exchange](https://math.stackexchange.com/questions/2977849/gradient-of-distance-squared-on-riemannian-manifold), but at that time it was of no use for me. Later I learned that one can show this identity in several ways, and here is mine.\n\n---\n\nLet $f(x) = d^2(x,y)$ be the square distance function. As you can see, this is \na function of $x$ only with a fixed $y\\in\\calM$. Our goal is to compute the Riemannian \ngradient $\\nabla_x f(x)$. \n\nWe start with a smooth curve $\\gamma(t)$ on the manifold $\\calM$ such that $\\gamma(0) = x$ (initial location) and $\\dot{\\gamma}(0) = \\xi \\in T_x \\calM$ (initial velocity). Then the directional derivative of $f$ at $x$ along $\\xi$ is defined as \n$$\nDf(x)[\\xi] = \\frac{d}{dt}f(\\gamma(t))\\bigg|_{t=0} = \\frac{d}{dt}d^2(\\gamma(t),y)\\bigg|_{t=0}.\n$$\nWe can apply the chain rule to the squared distance:\n$$\n\\frac{d}{dt}d^2(\\gamma(t),y)\\bigg|_{t=0} = 2d(\\gamma(t),y)\\cdot  \\frac{d}{dt}d(\\gamma(t),y)\\bigg|_{t=0} = 2d(x,y)\\cdot \\frac{d}{dt}d(\\gamma(t),y)\\bigg|_{t=0}.\n$$\nTo compute the derivative, we invoke the first variation formula for the Riemannian distance. Let $\\gamma_s (t)$ denote the minimizing geodesic from $\\alpha(s)$ to $y$, and define the variation of geodesics \n$$\n\\tilde{\\gamma}(s,t):= \\gamma_s (t),\n$$\nwith $\\tilde{\\gamma}(0,t) = \\gamma(t)$ being the geodesic from $x$ to $y$. Let $E(s) := d(\\alpha(s), y)$. Then $E(s)^2$ is the energy of the minimizing geodesic $\\gamma_s$, i.e., \n$$\nE(s)^2 = \\int_{0}^{1} \\bigg\\| \\frac{\\partial \\tilde{\\gamma}}{\\partial t}(s,t) \\bigg\\|^2 dt.\n$$\nHence, \n$$\nE'(0) = \\frac{1}{2d(x,y)} \\cdot \\left. \\frac{d}{ds} \\int_{0}^{1} \\left\\| \\frac{\\partial \\tilde{\\gamma}}{\\partial t}(s,t) \\right\\|^2 dt \\right|_{s=0}.\n$$\nWe now use the first variation formula for energy functional: if $\\tilde{\\gamma}(s,t)$ is a variation of geodesics such that $\\tilde{\\gamma}(s,1) = y$ is fixed and $\\tilde{\\gamma}(s,0) = \\alpha(s)$, then \n$$\n\\left. \\frac{d}{ds} \\int_{0}^{1} \\left\\| \\frac{\\partial \\tilde{\\gamma}}{\\partial t}(s,t) \\right\\|^2 dt \\right|_{s=0} = -2 \\left\\langle \\dot{\\gamma}(0), \\dot{\\alpha}(0) \\right\\rangle.\n$$\nHere, $\\gamma(t) = \\tilde{\\gamma}(0,t)$ is the minimizing geodesic from $x$ to $y$, and $\\dot{\\gamma}(0)$ is its initial velocity vector. By definition of the Riemannian logarithmic map, \n$$\n\\dot{\\gamma}(0) = \\frac{\\log_x y}{\\|\\log_x y \\|}\\cdot d(x,y).\n$$\nTherefore, \n$$\nE'(0) = \\frac{1}{2d(x,y)}\\cdot \\left(-2 \\langle \\dot{\\gamma}(0), \\xi \\rangle \\right) = -\\left\\langle\n\\frac{\\log_x y}{\\|\\log_x y \\|}, \\xi\n\\right\\rangle,\n$$\nwhich completes the proof of the first variation formula. This classical result states that for a smooth variation of points $\\gamma(t)$ and corresponding minimizing geodesics $c_t(s)$ from $\\gamma(t)$ to $y$, we have:\n$$\n\\frac{d}{dt}d(\\gamma(t),y)\\bigg|_{t=0} = - \\left\\langle \\frac{\\log_x y}{\\|\\log_x y\\|}, \\dot{\\gamma}(0)  \\right\\rangle.\n$$\nPlugging this into the chain rule, we obtain\n$$\n\\frac{d}{dt}d^2(\\gamma(t), y)\\bigg|_{t=0} = -2 \\langle \\log_x y, \\xi \\rangle.\n$$\nBy the definition of the Riemannian gradient, we have:\n$$\nD f(x)[\\xi] = \\langle \\nabla_x f(x), \\xi \\rangle.\n$$\nSince this identity must hold for every tangent vector $\\xi \\in T_x \\calM$, it follows that \n$$\n\\nabla_x f(x) = -2\\log_x y.\n$$\n\n\n\n\n\n[^1]: We assume that the logarithmic map is well-defined. For instance, you can't define a unique logarithmic map on a point on the unit hypersphere to its antipodal point.",
    "supporting": [
      "blog_004_GradientSquaredDistance_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}